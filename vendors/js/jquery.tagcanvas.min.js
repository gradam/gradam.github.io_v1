!function(a){"use strict";function y(a){return void 0!==a}function z(a){return"object"==typeof a&&null!=a}function A(a,b,c){return isNaN(a)?c:h(c,g(b,a))}function B(){return!1}function C(){return(new Date).valueOf()}function D(a,b){var e,c=[],d=a.length;for(e=0;e<d;++e)c.push(a[e]);return c.sort(b),c}function E(a){for(var c,d,b=a.length-1;b;)d=~~(Math.random()*b),c=a[b],a[b]=a[d],a[d]=c,--b}function F(a,b,c){this.x=a,this.y=b,this.z=c}function G(a,b){return b=b*Math.PI/180,a=a*Math.PI/180,new F(e(a)*f(b),-e(b),-f(a)*f(b))}function H(a){this[1]={1:a[0],2:a[1],3:a[2]},this[2]={1:a[3],2:a[4],3:a[5]},this[3]={1:a[6],2:a[7],3:a[8]}}function I(a,b,c,d,g){var h,i,k,l,o,m=[],n=2/a;for(o=Math.PI*(3-j(5)+(parseFloat(g)?parseFloat(g):0)),h=0;h<a;++h)i=h*n-1+n/2,k=j(1-i*i),l=h*o,m.push([f(l)*k*b,i*c,e(l)*k*d]);return m}function J(a,b,c,d,g,h){var i,m,n,o,p,q,k=[],l=2/a;for(m=Math.PI*(3-j(5)+(parseFloat(h)?parseFloat(h):0)),n=0;n<a;++n)o=n*l-1+l/2,i=n*m,p=f(i),q=e(i),k.push(b?[o*c,p*d,q*g]:[p*c,o*d,q*g]);return k}function K(a,b,c,d,g,h){var i,l,m,n,j=[],k=2*Math.PI/b;for(l=0;l<b;++l)i=l*k,m=f(i),n=e(i),j.push(a?[h*c,m*d,n*g]:[m*c,h*d,n*g]);return j}function L(a,b,c,d,e){return J(a,0,b,c,d,e)}function M(a,b,c,d,e){return J(a,1,b,c,d,e)}function N(a,b,c,d,e){return e=isNaN(e)?0:1*e,K(0,a,b,c,d,e)}function O(a,b,c,d,e){return e=isNaN(e)?0:1*e,K(1,a,b,c,d,e)}function P(a){var b=new Image;b.onload=function(){var c=b.width/2,d=b.height/2;a.centreFunc=function(a,e,f,g,h){a.setTransform(1,0,0,1,0,0),a.globalAlpha=1,a.drawImage(b,g-c,h-d)}},b.src=a.centreImage}function Q(a,b){var d,e,c=a,f=(1*b).toPrecision(3)+")";return"#"===a[0]?(l[a]||(4===a.length?l[a]="rgba("+n[a[1]]+n[a[2]]+n[a[3]]:l[a]="rgba("+m[a.substr(1,2)]+m[a.substr(3,2)]+m[a.substr(5,2)]),c=l[a]+f):"rgb("===a.substr(0,4)||"hsl("===a.substr(0,4)?c=a.replace("(","a(").replace(")",","+f):"rgba("!==a.substr(0,5)&&"hsla("!==a.substr(0,5)||(d=a.lastIndexOf(",")+1,e=a.indexOf(")"),b*=parseFloat(a.substring(d,e)),c=a.substr(0,d)+b.toPrecision(3)+")"),c}function R(a,b){if(window.G_vmlCanvasManager)return null;var c=v.createElement("canvas");return c.width=a,c.height=b,c}function S(){var b,c,a=R(3,3);return!!a&&(b=a.getContext("2d"),b.strokeStyle="#000",b.shadowColor="#fff",b.shadowBlur=3,b.globalAlpha=0,b.strokeRect(2,2,2,2),b.globalAlpha=1,c=b.getImageData(2,2,1,1),a=null,c.data[0]>0)}function T(a,b,c,d){var f,e=a.createLinearGradient(0,0,b,0);for(f in d)e.addColorStop(1-f,d[f]);a.fillStyle=e,a.fillRect(0,c,b,1)}function U(a,b,c){var i,j,k,l,d=1024,e=1,f=a.weightGradient;if(a.gCanvas)j=a.gCanvas.getContext("2d"),e=a.gCanvas.height;else{if(z(f[0])?e=f.length:f=[f],a.gCanvas=i=R(d,e),!i)return null;for(j=i.getContext("2d"),k=0;k<e;++k)T(j,d,k,f[k])}return c=g(h(c||0,e-1),0),l=j.getImageData(~~((d-1)*b),c,1,1).data,"rgba("+l[0]+","+l[1]+","+l[2]+","+l[3]/255+")"}function V(a,b,c,e,f,g,h,i,j,k,l,m){var p,q,n=f+(i||0)+(j.length&&j[0]<0?d(j[0]):0),o=g+(i||0)+(j.length&&j[1]<0?d(j[1]):0);for(a.font=b,a.textBaseline="top",a.fillStyle=c,h&&(a.shadowColor=h),i&&(a.shadowBlur=i),j.length&&(a.shadowOffsetX=j[0],a.shadowOffsetY=j[1]),p=0;p<e.length;++p)q=0,l&&("right"==m?q=k-l[p]:"centre"==m&&(q=(k-l[p])/2)),a.fillText(e[p],n+q,o),o+=parseInt(b)}function W(a,b,c,d,e,f,g){f?(a.beginPath(),a.moveTo(b,c+e-f),a.arcTo(b,c,b+f,c,f),a.arcTo(b+d,c,b+d,c+f,f),a.arcTo(b+d,c+e,b+d-f,c+e,f),a.arcTo(b,c+e,b,c+e-f,f),a.closePath(),a[g?"stroke":"fill"]()):a[g?"strokeRect":"fillRect"](b,c,d,e)}function X(a,b,c,d,e,f,g,h,i){this.strings=a,this.font=b,this.width=c,this.height=d,this.maxWidth=e,this.stringWidths=f,this.align=g,this.valign=h,this.scale=i}function Y(a,b,c){var e,d=R(b,c);return d?(e=d.getContext("2d"),e.drawImage(a,(b-a.width)/2,(c-a.height)/2),d):null}function Z(a,b,c){var e,d=R(b,c);return d?(e=d.getContext("2d"),e.drawImage(a,0,0,b,c),d):null}function $(a,b,c,d,e,f,g,i,j,k){var o,p,q,r,s,t,u,v,l=b+(2*i+f)*d,m=c+(2*i+f)*d,n=R(l,m);return n?(f*=d,j*=d,p=q=f/2,r=l-f,s=m-f,i=i*d+p,o=n.getContext("2d"),v=h(j,r/2,s/2),e&&(o.fillStyle=e,W(o,p,q,r,s,v)),f&&(o.strokeStyle=g,o.lineWidth=f,W(o,p,q,r,s,v,!0)),k?(t=R(l,m),u=t.getContext("2d"),u.drawImage(a,i,i,b,c),u.globalCompositeOperation="source-in",u.fillStyle=g,u.fillRect(0,0,l,m),u.globalCompositeOperation="destination-over",u.drawImage(n,0,0),u.globalCompositeOperation="source-over",o.drawImage(t,0,0)):o.drawImage(a,i,i,a.width,a.height),{image:n,width:l/d,height:m/d}):null}function _(a,b,c,d,e){var f,i,j=parseFloat(b),k=g(c,d);return(f=R(c,d))?(b.indexOf("%")>0?j=k*j/100:j*=e,i=f.getContext("2d"),i.globalCompositeOperation="source-over",i.fillStyle="#fff",j>=k/2?(j=h(c,d)/2,i.beginPath(),i.moveTo(c/2,d/2),i.arc(c/2,d/2,j,0,2*Math.PI,!1),i.fill(),i.closePath()):(j=h(c/2,d/2,j),W(i,0,0,c,d,j,!0),i.fill()),i.globalCompositeOperation="source-in",i.drawImage(a,0,0,c,d),f):null}function aa(a,b,c,e,f,g,h){var o,p,i=d(h[0]),j=d(h[1]),k=b+(i>g?i+g:2*g)*e,l=c+(j>g?j+g:2*g)*e,m=e*((g||0)+(h[0]<0?i:0)),n=e*((g||0)+(h[1]<0?j:0));return(o=R(k,l))?(p=o.getContext("2d"),f&&(p.shadowColor=f),g&&(p.shadowBlur=g*e),h&&(p.shadowOffsetX=h[0]*e,p.shadowOffsetY=h[1]*e),p.drawImage(a,m,n,b,c),{image:o,width:k/e,height:l/e}):null}function ba(a,b,c){var g,h,i,j,k,l,m,n,d=parseInt(a.toString().length*c),e=parseInt(2*c*a.length),f=R(d,e);if(!f)return null;for(g=f.getContext("2d"),g.fillStyle="#000",g.fillRect(0,0,d,e),V(g,c+"px "+b,"#fff",a,0,0,0,0,[],"centre"),h=g.getImageData(0,0,d,e),i=h.width,j=h.height,n={min:{x:i,y:j},max:{x:-1,y:-1}},l=0;l<j;++l)for(k=0;k<i;++k)m=4*(l*i+k),h.data[m+1]>0&&(k<n.min.x&&(n.min.x=k),k>n.max.x&&(n.max.x=k),l<n.min.y&&(n.min.y=l),l>n.max.y&&(n.max.y=l));return i!=d&&(n.min.x*=d/i,n.max.x*=d/i),j!=e&&(n.min.y*=d/j,n.max.y*=d/j),f=null,n}function ca(a){return"'"+a.replace(/(\'|\")/g,"").replace(/\s*,\s*/g,"', '")+"'"}function da(a,b,c){c=c||v,c.addEventListener?c.addEventListener(a,b,!1):c.attachEvent("on"+a,b)}function ea(a,b,c){c=c||v,c.removeEventListener?c.removeEventListener(a,b):c.detachEvent("on"+a,b)}function fa(a,b,c,d){var f,g,h,i,j,k,e=d.imageScale;return b.complete?a.complete?(b.width=b.width,b.height=b.height,e&&(a.width=b.width*e,a.height=b.height*e),c.iw=a.width,c.ih=a.height,d.txtOpt&&(g=a,f=d.zoomMax*d.txtScale,j=c.iw*f,k=c.ih*f,j<b.naturalWidth||k<b.naturalHeight?(g=Z(a,j,k))&&(c.fimage=g):(j=c.iw,k=c.ih,f=1),parseFloat(d.imageRadius)&&(c.image=c.fimage=a=_(c.image,d.imageRadius,j,k,f)),c.HasText()||(d.shadow&&(g=aa(c.image,j,k,f,d.shadow,d.shadowBlur,d.shadowOffset))&&(c.fimage=g.image,c.w=g.width,c.h=g.height),(d.bgColour||d.bgOutlineThickness)&&(h="tag"==d.bgColour?ga(c.a,"background-color"):d.bgColour,i="tag"==d.bgOutline?ga(c.a,"color"):d.bgOutline||d.textColour,j=c.fimage.width,k=c.fimage.height,"colour"==d.outlineMethod&&(g=$(c.fimage,j,k,f,h,d.bgOutlineThickness,c.outline.colour,d.padding,d.bgRadius,1))&&(c.oimage=g.image),(g=$(c.fimage,j,k,f,h,d.bgOutlineThickness,i,d.padding,d.bgRadius))&&(c.fimage=g.image,c.w=g.width,c.h=g.height)),"size"==d.outlineMethod&&(d.outlineIncrease>0?(c.iw+=2*d.outlineIncrease,c.ih+=2*d.outlineIncrease,j=f*c.iw,k=f*c.ih,g=Z(c.fimage,j,k),c.oimage=g,c.fimage=Y(c.fimage,c.oimage.width,c.oimage.height)):(j=f*(c.iw+2*d.outlineIncrease),k=f*(c.ih+2*d.outlineIncrease),g=Z(c.fimage,j,k),c.oimage=Y(g,c.fimage.width,c.fimage.height))))),void c.Init()):da("load",function(){fa(a,b,c,d)},a):da("load",function(){fa(a,b,c,d)},b)}function ga(a,b){var c=v.defaultView,d=b.replace(/\-([a-z])/g,function(a){return a.charAt(1).toUpperCase()});return c&&c.getComputedStyle&&c.getComputedStyle(a,null).getPropertyValue(b)||a.currentStyle&&a.currentStyle[d]}function ha(a,b,c){var e,d=1;return b?d=1*(a.getAttribute(b)||c):(e=ga(a,"font-size"))&&(d=e.indexOf("px")>-1&&1*e.replace("px","")||e.indexOf("pt")>-1&&1.25*e.replace("pt","")||3.3*e),d}function ia(a){return a.target&&y(a.target.id)?a.target.id:a.srcElement.parentNode.id}function ja(a,b){var c,d,e=parseInt(ga(b,"width"))/b.width,f=parseInt(ga(b,"height"))/b.height;return y(a.offsetX)?c={x:a.offsetX,y:a.offsetY}:(d=va(b.id),y(a.changedTouches)&&(a=a.changedTouches[0]),a.pageX&&(c={x:a.pageX-d.x,y:a.pageY-d.y})),c&&e&&f&&(c.x/=e,c.y/=f),c}function ka(a){var b=a.target||a.fromElement.parentNode,c=Aa.tc[b.id];c&&(c.mx=c.my=-1,c.UnFreeze(),c.EndDrag())}function la(a){var b,d,e,c=Aa,f=ia(a);for(b in c.tc)d=c.tc[b],d.tttimer&&(clearTimeout(d.tttimer),d.tttimer=null);f&&c.tc[f]&&(d=c.tc[f],(e=ja(a,d.canvas))&&(d.mx=e.x,d.my=e.y,d.Drag(a,e)),d.drawn=0)}function ma(a){var b=Aa,c=v.addEventListener?0:1,d=ia(a);d&&a.button==c&&b.tc[d]&&b.tc[d].BeginDrag(a)}function na(a){var e,b=Aa,c=v.addEventListener?0:1,d=ia(a);d&&a.button==c&&b.tc[d]&&(e=b.tc[d],la(a),e.EndDrag()||e.touchState||e.Clicked(a))}function oa(a){var d,b=ia(a),c=b&&Aa.tc[b];c&&a.changedTouches&&(1==a.touches.length&&0==c.touchState?(c.touchState=1,c.BeginDrag(a),(d=ja(a,c.canvas))&&(c.mx=d.x,c.my=d.y,c.drawn=0)):2==a.targetTouches.length&&c.pinchZoom?(c.touchState=3,c.EndDrag(),c.BeginPinch(a)):(c.EndDrag(),c.EndPinch(),c.touchState=0))}function pa(a){var b=ia(a),c=b&&Aa.tc[b];if(c&&a.changedTouches){switch(c.touchState){case 1:c.Draw(),c.Clicked();break;case 2:c.EndDrag();break;case 3:c.EndPinch()}c.touchState=0}}function qa(a){var b,d,e,c=Aa,f=ia(a);for(b in c.tc)d=c.tc[b],d.tttimer&&(clearTimeout(d.tttimer),d.tttimer=null);if((d=f&&c.tc[f])&&a.changedTouches&&d.touchState){switch(d.touchState){case 1:case 2:(e=ja(a,d.canvas))&&(d.mx=e.x,d.my=e.y,d.Drag(a,e)&&(d.touchState=2));break;case 3:d.Pinch(a)}d.drawn=0}}function ra(a){var b=Aa,c=ia(a);c&&b.tc[c]&&(a.cancelBubble=!0,a.returnValue=!1,a.preventDefault&&a.preventDefault(),b.tc[c].Wheel((a.wheelDelta||a.detail)>0))}function sa(a){var b,c=Aa;clearTimeout(c.scrollTimer);for(b in c.tc)c.tc[b].Pause();c.scrollTimer=setTimeout(function(){var a,b=Aa;for(a in b.tc)b.tc[a].Resume()},c.scrollPause)}function ta(){ua(C())}function ua(a){var c,b=Aa.tc;Aa.NextFrame(Aa.interval),a=a||C();for(c in b)b[c].Draw(a)}function va(a){var b=v.getElementById(a),c=b.getBoundingClientRect(),d=v.documentElement,e=v.body,f=window,g=f.pageXOffset||d.scrollLeft,h=f.pageYOffset||d.scrollTop,i=d.clientLeft||e.clientLeft,j=d.clientTop||e.clientTop;return{x:c.left+g-i,y:c.top+h-j}}function wa(a,b,c,d){var e=a.radius*a.z1/(a.z1+a.z2+b.z);return{x:b.x*e*c,y:b.y*e*d,z:b.z,w:(a.z1-b.z)/a.z2}}function xa(a){this.e=a,this.br=0,this.line=[],this.text=[],this.original=a.innerText||a.textContent}function ya(a,b){this.ts=null,this.tc=a,this.tag=b,this.x=this.y=this.w=this.h=this.sc=1,this.z=0,this.pulse=1,this.pulsate=a.pulsateTo<1,this.colour=a.outlineColour,this.adash=~~a.outlineDash,this.agap=~~a.outlineDashSpace||this.adash,this.aspeed=1*a.outlineDashSpeed,"tag"==this.colour?this.colour=ga(b.a,"color"):"tagbg"==this.colour&&(this.colour=ga(b.a,"background-color")),this.Draw=this.pulsate?this.DrawPulsate:this.DrawSimple,this.radius=0|a.outlineRadius,this.SetMethod(a.outlineMethod)}function za(a,b,c,d,e,f,g,h,i,j,k,l,m,n){this.tc=a,this.image=null,this.text=b,this.text_original=n,this.line_widths=[],this.title=c.title||null,this.a=c,this.position=new F(d[0],d[1],d[2]),this.x=this.y=this.z=0,this.w=e,this.h=f,this.colour=g||a.textColour,this.bgColour=h||a.bgColour,this.bgRadius=0|i,this.bgOutline=j||this.colour,this.bgOutlineThickness=0|k,this.textFont=l||a.textFont,this.padding=0|m,this.sc=this.alpha=1,this.weighted=!a.weight,this.outline=new ya(a,this)}function Aa(a,b,c){var d,e,k,f=v.getElementById(a),j=["id","class","innerHTML"];if(!f)throw 0;if(y(window.G_vmlCanvasManager)&&(f=window.G_vmlCanvasManager.initElement(f),this.ie=parseFloat(navigator.appVersion.split("MSIE")[1])),f&&(!f.getContext||!f.getContext("2d").fillText)){for(e=v.createElement("DIV"),d=0;d<j.length;++d)e[j[d]]=f[j[d]];throw f.parentNode.insertBefore(e,f),f.parentNode.removeChild(f),0}for(d in Aa.options)this[d]=c&&y(c[d])?c[d]:y(Aa[d])?Aa[d]:Aa.options[d];if(this.canvas=f,this.ctxt=f.getContext("2d"),this.z1=250/g(this.depth,.001),this.z2=this.z1/this.zoom,this.radius=.0075*h(f.height,f.width),this.max_radius=100,this.max_weight=[],this.min_weight=[],this.textFont=this.textFont&&ca(this.textFont),this.textHeight*=1,this.imageRadius=this.imageRadius.toString(),this.pulsateTo=A(this.pulsateTo,0,1),this.minBrightness=A(this.minBrightness,0,1),this.maxBrightness=A(this.maxBrightness,this.minBrightness,1),this.ctxt.textBaseline="top",this.lx=(this.lock+"").indexOf("x")+1,this.ly=(this.lock+"").indexOf("y")+1,this.frozen=this.dx=this.dy=this.fixedAnim=this.touchState=0,this.fixedAlpha=1,this.source=b||a,this.repeatTags=h(64,~~this.repeatTags),this.minTags=h(200,~~this.minTags),~~this.scrollPause>0?Aa.scrollPause=~~this.scrollPause:this.scrollPause=0,this.minTags>0&&this.repeatTags<1&&(d=this.GetTags().length)&&(this.repeatTags=i(this.minTags/d)-1),this.transform=H.Identity(),this.startTime=this.time=C(),this.mx=this.my=-1,this.centreImage&&P(this),this.Animate=this.dragControl?this.AnimateDrag:this.AnimatePosition,this.animTiming="function"==typeof Aa[this.animTiming]?Aa[this.animTiming]:Aa.Smooth,this.shadowBlur||this.shadowOffset[0]||this.shadowOffset[1]?(this.ctxt.shadowColor=this.shadow,this.shadow=this.ctxt.shadowColor,this.shadowAlpha=S()):delete this.shadow,this.Load(),b&&this.hideTags&&function(a){Aa.loaded?a.HideTags():da("load",function(){a.HideTags()},window)}(this),this.yaw=this.initial?this.initial[0]*this.maxSpeed:0,this.pitch=this.initial?this.initial[1]*this.maxSpeed:0,this.tooltip?(this.ctitle=f.title,f.title="","native"==this.tooltip?this.Tooltip=this.TooltipNative:(this.Tooltip=this.TooltipDiv,this.ttdiv||(this.ttdiv=v.createElement("div"),this.ttdiv.className=this.tooltipClass,this.ttdiv.style.position="absolute",this.ttdiv.style.zIndex=f.style.zIndex+1,da("mouseover",function(a){a.target.style.display="none"},this.ttdiv),v.body.appendChild(this.ttdiv)))):this.Tooltip=this.TooltipNone,!this.noMouse&&!x[a])for(x[a]=[["mousemove",la],["mouseout",ka],["mouseup",na],["touchstart",oa],["touchend",pa],["touchcancel",pa],["touchmove",qa]],this.dragControl&&(x[a].push(["mousedown",ma]),x[a].push(["selectstart",B])),this.wheelZoom&&(x[a].push(["mousewheel",ra]),x[a].push(["DOMMouseScroll",ra])),this.scrollPause&&x[a].push(["scroll",sa,window]),d=0;d<x[a].length;++d)e=x[a][d],da(e[0],e[1],e[2]?e[2]:f);Aa.started||(k=window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,Aa.NextFrame=k?Aa.NextFrameRAF:Aa.NextFrameTimeout,Aa.interval=this.interval,Aa.NextFrame(this.interval),Aa.started=1)}function Ba(a){var b=a.targetTouches[0],c=a.targetTouches[1];return j(k(c.pageX-b.pageX,2)+k(c.pageY-b.pageY,2))}function Ca(a,b){Aa.tc[b]&&Aa.tc[b][a]()}var b,c,o,p,q,r,s,t,u,w,d=Math.abs,e=Math.sin,f=Math.cos,g=Math.max,h=Math.min,i=Math.ceil,j=Math.sqrt,k=Math.pow,l={},m={},n={0:"0,",1:"17,",2:"34,",3:"51,",4:"68,",5:"85,",6:"102,",7:"119,",8:"136,",9:"153,",a:"170,",A:"170,",b:"187,",B:"187,",c:"204,",C:"204,",d:"221,",D:"221,",e:"238,",E:"238,",f:"255,",F:"255,"},v=document,x={};for(b=0;b<256;++b)c=b.toString(16),b<16&&(c="0"+c),m[c]=m[c.toUpperCase()]=b.toString()+",";s=F.prototype,s.length=function(){return j(this.x*this.x+this.y*this.y+this.z*this.z)},s.dot=function(a){return this.x*a.x+this.y*a.y+this.z*a.z},s.cross=function(a){return new F(this.y*a.z-this.z*a.y,this.z*a.x-this.x*a.z,this.x*a.y-this.y*a.x)},s.angle=function(a){var c,b=this.dot(a);return 0==b?Math.PI/2:(c=b/(this.length()*a.length()),c>=1?0:c<=-1?Math.PI:Math.acos(c))},s.unit=function(){var a=this.length();return new F(this.x/a,this.y/a,this.z/a)},r=H.prototype,H.Identity=function(){return new H([1,0,0,0,1,0,0,0,1])},H.Rotation=function(a,b){var c=e(a),d=f(a),g=1-d;return new H([d+k(b.x,2)*g,b.x*b.y*g-b.z*c,b.x*b.z*g+b.y*c,b.y*b.x*g+b.z*c,d+k(b.y,2)*g,b.y*b.z*g-b.x*c,b.z*b.x*g-b.y*c,b.z*b.y*g+b.x*c,d+k(b.z,2)*g])},r.mul=function(a){var c,d,b=[],e=a.xform?1:0;for(c=1;c<=3;++c)for(d=1;d<=3;++d)e?b.push(this[c][1]*a[1][d]+this[c][2]*a[2][d]+this[c][3]*a[3][d]):b.push(this[c][d]*a);return new H(b)},r.xform=function(a){var b={},c=a.x,d=a.y,e=a.z;return b.x=c*this[1][1]+d*this[2][1]+e*this[3][1],b.y=c*this[1][2]+d*this[2][2]+e*this[3][2],b.z=c*this[1][3]+d*this[2][3]+e*this[3][3],b},u=X.prototype,u.SetImage=function(a,b,c,d,e,f,g,h){this.image=a,this.iwidth=b*this.scale,this.iheight=c*this.scale,this.ipos=d,this.ipad=e*this.scale,this.iscale=h,this.ialign=f,this.ivalign=g},u.Align=function(a,b,c){var d=0;return"right"==c||"bottom"==c?d=b-a:"left"!=c&&"top"!=c&&(d=(b-a)/2),d},u.Create=function(a,b,c,e,f,i,j,k,l){var m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,D,E,B=d(j[0]),C=d(j[1]);return k=g(k,B+i,C+i),q=2*(k+e),s=2*(k+e),n=this.width+q,o=this.height+s,u=v=k+e,this.image&&(w=x=k+e,y=this.iwidth,z=this.iheight,"top"==this.ipos||"bottom"==this.ipos?(y<this.width?w+=this.Align(y,this.width,this.ialign):u+=this.Align(this.width,y,this.align),"top"==this.ipos?v+=z+this.ipad:x+=this.height+this.ipad,n=g(n,y+q),o+=z+this.ipad):(z<this.height?x+=this.Align(z,this.height,this.ivalign):v+=this.Align(this.height,z,this.valign),"right"==this.ipos?w+=this.width+this.ipad:u+=y+this.ipad,n+=y+this.ipad,o=g(o,z+s))),(m=R(n,o))?(q=s=e/2,r=n-e,t=o-e,A=h(l,r/2,t/2),p=m.getContext("2d"),b&&(p.fillStyle=b,W(p,q,s,r,t,A)),e&&(p.strokeStyle=c,p.lineWidth=e,W(p,q,s,r,t,A,!0)),(i||B||C)&&(D=R(n,o))&&(E=p,p=D.getContext("2d")),V(p,this.font,a,this.strings,u,v,0,0,[],this.maxWidth,this.stringWidths,this.align),this.image&&p.drawImage(this.image,w,x,y,z),E&&(p=E,f&&(p.shadowColor=f),i&&(p.shadowBlur=i),p.shadowOffsetX=j[0],p.shadowOffsetY=j[1],p.drawImage(D,0,0)),m):null},t=xa.prototype,t.Empty=function(){for(var a=0;a<this.text.length;++a)if(this.text[a].length)return!1;return!0},t.Lines=function(a){var c,d,e,b=a?1:0;for(a=a||this.e,c=a.childNodes,d=c.length,e=0;e<d;++e)"BR"==c[e].nodeName?(this.text.push(this.line.join(" ")),this.br=1):3==c[e].nodeType?this.br?(this.line=[c[e].nodeValue],this.br=0):this.line.push(c[e].nodeValue):this.Lines(c[e]);return b||this.br||this.text.push(this.line.join(" ")),this.text},t.SplitWidth=function(a,b,c,d){var e,f,g,h=[];for(b.font=d+"px "+c,e=0;e<this.text.length;++e){for(g=this.text[e].split(/\s+/),this.line=[g[0]],f=1;f<g.length;++f)b.measureText(this.line.join(" ")+" "+g[f]).width>a?(h.push(this.line.join(" ")),this.line=[g[f]]):this.line.push(g[f]);h.push(this.line.join(" "))}return this.text=h},o=ya.prototype,o.SetMethod=function(a){var b={block:["PreDraw","DrawBlock"],colour:["PreDraw","DrawColour"],outline:["PostDraw","DrawOutline"],classic:["LastDraw","DrawOutline"],size:["PreDraw","DrawSize"],none:["LastDraw"]},c=b[a]||b.outline;"none"==a?this.Draw=function(){return 1}:this.drawFunc=this[c[1]],this[c[0]]=this.Draw},o.Update=function(a,b,c,d,e,f,g,h){var i=this.tc.outlineOffset,j=2*i;this.x=e*a+g-i,this.y=e*b+h-i,this.w=e*c+j,this.h=e*d+j,this.sc=e,this.z=f},o.Ants=function(a){if(this.adash){var l,b=this.adash,c=this.agap,e=this.aspeed,f=b+c,g=0,h=b,i=c,j=0,k=0;e&&(k=d(e)*(C()-this.ts)/50,e<0&&(k=864e4-k),e=~~k%f),e?(b>=e?(g=b-e,h=e):(i=f-e,j=c-i),l=[g,i,h,j]):l=[b,c],a.setLineDash(l)}},o.DrawOutline=function(a,b,c,d,e,f){var g=h(this.radius,e/2,d/2);a.strokeStyle=f,this.Ants(a),W(a,b,c,d,e,g,!0)},o.DrawSize=function(a,b,c,d,e,f,g,h,i){var l,m,n,j=g.w,k=g.h;return this.pulsate?(n=g.image?(g.image.height+this.tc.outlineIncrease)/g.image.height:g.oscale,m=g.fimage||g.image,l=1+(n-1)*(1-this.pulse),g.h*=l,g.w*=l):m=g.oimage,g.alpha=1,g.Draw(a,h,i,m),g.h=k,g.w=j,1},o.DrawColour=function(a,b,c,d,e,f,g,h,i){return g.oimage?(this.pulse<1?(g.alpha=1-k(this.pulse,2),g.Draw(a,h,i,g.fimage),g.alpha=this.pulse):g.alpha=1,g.Draw(a,h,i,g.oimage),1):this[g.image?"DrawColourImage":"DrawColourText"](a,b,c,d,e,f,g,h,i)},o.DrawColourText=function(a,b,c,d,e,f,g,h,i){var j=g.colour;return g.colour=f,g.alpha=1,g.Draw(a,h,i),g.colour=j,1},o.DrawColourImage=function(a,b,c,d,e,f,i,j,l){var r,m=a.canvas,n=~~g(b,0),o=~~g(c,0),p=h(m.width-n,d)+.5|0,q=h(m.height-o,e)+.5|0;return w?(w.width=p,w.height=q):w=R(p,q),w?(r=w.getContext("2d"),r.drawImage(m,n,o,p,q,0,0,p,q),a.clearRect(n,o,p,q),this.pulsate?i.alpha=1-k(this.pulse,2):i.alpha=1,i.Draw(a,j,l),a.setTransform(1,0,0,1,0,0),a.save(),a.beginPath(),a.rect(n,o,p,q),a.clip(),a.globalCompositeOperation="source-in",a.fillStyle=f,a.fillRect(n,o,p,q),a.restore(),a.globalAlpha=1,a.globalCompositeOperation="destination-over",a.drawImage(w,0,0,p,q,n,o,p,q),a.globalCompositeOperation="source-over",1):this.SetMethod("outline")},o.DrawBlock=function(a,b,c,d,e,f){var g=h(this.radius,e/2,d/2);a.fillStyle=f,W(a,b,c,d,e,g)},o.DrawSimple=function(a,b,c,d,e,f){var g=this.tc;return a.setTransform(1,0,0,1,0,0),a.strokeStyle=this.colour,a.lineWidth=g.outlineThickness,a.shadowBlur=a.shadowOffsetX=a.shadowOffsetY=0,a.globalAlpha=f?e:1,this.drawFunc(a,this.x,this.y,this.w,this.h,this.colour,b,c,d)},o.DrawPulsate=function(a,b,c,d){var e=C()-this.ts,g=this.tc,h=g.pulsateTo+(1-g.pulsateTo)*(.5+f(2*Math.PI*e/(1e3*g.pulsateTime))/2);return this.pulse=h=Aa.Smooth(1,h),this.DrawSimple(a,b,c,d,h,1)},o.Active=function(a,b,c){var d=b>=this.x&&c>=this.y&&b<=this.x+this.w&&c<=this.y+this.h;return this.ts=d?this.ts||C():null,d},o.PreDraw=o.PostDraw=o.LastDraw=B,p=za.prototype,p.Init=function(a){var b=this.tc;this.textHeight=b.textHeight,this.HasText()?this.Measure(b.ctxt,b):(this.w=this.iw,this.h=this.ih),this.SetShadowColour=b.shadowAlpha?this.SetShadowColourAlpha:this.SetShadowColourFixed,this.SetDraw(b)},p.Draw=B,p.HasText=function(){return this.text&&this.text[0].length>0},p.EqualTo=function(a){var b=a.getElementsByTagName("img");return this.a.href!=a.href?0:b.length?this.image.src==b[0].src:(a.innerText||a.textContent)==this.text_original},p.SetImage=function(a){this.image=this.fimage=a},p.SetDraw=function(a){this.Draw=this.fimage?a.ie>7?this.DrawImageIE:this.DrawImage:this.DrawText,a.noSelect&&(this.CheckActive=B)},p.MeasureText=function(a){var b,e,c=this.text.length,d=0;for(b=0;b<c;++b)this.line_widths[b]=e=a.measureText(this.text[b]).width,d=g(d,e);return d},p.Measure=function(a,b){var d,e,f,g,h,i,j,k,l,c=ba(this.text,this.textFont,this.textHeight);j=c?c.max.y+c.min.y:this.textHeight,a.font=this.font=this.textHeight+"px "+this.textFont,i=this.MeasureText(a),b.txtOpt&&(d=b.txtScale,e=d*this.textHeight,f=e+"px "+this.textFont,g=[d*b.shadowOffset[0],d*b.shadowOffset[1]],a.font=f,h=this.MeasureText(a),l=new X(this.text,f,h+d,d*j+d,h,this.line_widths,b.textAlign,b.textVAlign,d),this.image&&l.SetImage(this.image,this.iw,this.ih,b.imagePosition,b.imagePadding,b.imageAlign,b.imageVAlign,b.imageScale),k=l.Create(this.colour,this.bgColour,this.bgOutline,d*this.bgOutlineThickness,b.shadow,d*b.shadowBlur,g,d*this.padding,d*this.bgRadius),"colour"==b.outlineMethod?this.oimage=l.Create(this.outline.colour,this.bgColour,this.outline.colour,d*this.bgOutlineThickness,b.shadow,d*b.shadowBlur,g,d*this.padding,d*this.bgRadius):"size"==b.outlineMethod&&(c=ba(this.text,this.textFont,this.textHeight+b.outlineIncrease),e=c.max.y+c.min.y,f=d*(this.textHeight+b.outlineIncrease)+"px "+this.textFont,a.font=f,h=this.MeasureText(a),l=new X(this.text,f,h+d,d*e+d,h,this.line_widths,b.textAlign,b.textVAlign,d),this.image&&l.SetImage(this.image,this.iw+b.outlineIncrease,this.ih+b.outlineIncrease,b.imagePosition,b.imagePadding,b.imageAlign,b.imageVAlign,b.imageScale),this.oimage=l.Create(this.colour,this.bgColour,this.bgOutline,d*this.bgOutlineThickness,b.shadow,d*b.shadowBlur,g,d*this.padding,d*this.bgRadius),this.oscale=this.oimage.width/k.width,b.outlineIncrease>0?k=Y(k,this.oimage.width,this.oimage.height):this.oimage=Y(this.oimage,k.width,k.height)),k&&(this.fimage=k,i=this.fimage.width/d,j=this.fimage.height/d),this.SetDraw(b),b.txtOpt=!!this.fimage),this.h=j,this.w=i},p.SetFont=function(a,b,c,d){this.textFont=a,this.colour=b,this.bgColour=c,this.bgOutline=d,this.Measure(this.tc.ctxt,this.tc)},p.SetWeight=function(a){var d,e,b=this.tc,c=b.weightMode.split(/[, ]/),f=a.length;if(this.HasText()){for(this.weighted=!0,e=0;e<f;++e)d=c[e]||"size","both"==d?(this.Weight(a[e],b.ctxt,b,"size",b.min_weight[e],b.max_weight[e],e),this.Weight(a[e],b.ctxt,b,"colour",b.min_weight[e],b.max_weight[e],e)):this.Weight(a[e],b.ctxt,b,d,b.min_weight[e],b.max_weight[e],e);this.Measure(b.ctxt,b)}},p.Weight=function(a,b,c,d,e,f,h){a=isNaN(a)?1:a;var i=(a-e)/(f-e);"colour"==d?this.colour=U(c,i,h):"bgcolour"==d?this.bgColour=U(c,i,h):"bgoutline"==d?this.bgOutline=U(c,i,h):"outline"==d?this.outline.colour=U(c,i,h):"size"==d&&(c.weightSizeMin>0&&c.weightSizeMax>c.weightSizeMin?this.textHeight=c.weightSize*(c.weightSizeMin+(c.weightSizeMax-c.weightSizeMin)*i):this.textHeight=g(1,a*c.weightSize))},p.SetShadowColourFixed=function(a,b,c){a.shadowColor=b},p.SetShadowColourAlpha=function(a,b,c){a.shadowColor=Q(b,c)},p.DrawText=function(a,b,c){var h,i,d=this.tc,e=this.x,f=this.y,g=this.sc;for(a.globalAlpha=this.alpha,a.fillStyle=this.colour,d.shadow&&this.SetShadowColour(a,d.shadow,this.alpha),a.font=this.font,e+=b/g,f+=c/g-this.h/2,h=0;h<this.text.length;++h)i=e,"right"==d.textAlign?i+=this.w/2-this.line_widths[h]:"centre"==d.textAlign?i-=this.line_widths[h]/2:i-=this.w/2,a.setTransform(g,0,0,g,g*i,g*f),a.fillText(this.text[h],0,0),f+=this.textHeight},p.DrawImage=function(a,b,c,d){var e=this.x,f=this.y,g=this.sc,h=d||this.fimage,i=this.w,j=this.h,k=this.alpha,l=this.shadow;a.globalAlpha=k,l&&this.SetShadowColour(a,l,k),e+=b/g-i/2,f+=c/g-j/2,a.setTransform(g,0,0,g,g*e,g*f),a.drawImage(h,0,0,i,j)},p.DrawImageIE=function(a,b,c){var d=this.fimage,e=this.sc,f=d.width=this.w*e,g=d.height=this.h*e,h=this.x*e+b-f/2,i=this.y*e+c-g/2;a.setTransform(1,0,0,1,0,0),a.globalAlpha=this.alpha,a.drawImage(d,h,i)},p.Calc=function(a,b){var c,d=this.tc,e=d.minBrightness,f=d.maxBrightness,g=d.max_radius;return c=a.xform(this.position),this.xformed=c,c=wa(d,c,d.stretchX,d.stretchY),this.x=c.x,this.y=c.y,this.z=c.z,this.sc=c.w,this.alpha=b*A(e+(f-e)*(g-this.z)/(2*g),0,1),this.xformed},p.UpdateActive=function(a,b,c){var d=this.outline,e=this.w,f=this.h,g=this.x-e/2,h=this.y-f/2;return d.Update(g,h,e,f,this.sc,this.z,b,c),d},p.CheckActive=function(a,b,c){var d=this.tc,e=this.UpdateActive(a,b,c);return e.Active(a,d.mx,d.my)?e:null},p.Clicked=function(a){var e,b=this.a,c=b.target,d=b.href;if(""==c||"_self"==c){if(v.createEvent){if(e=v.createEvent("MouseEvents"),e.initMouseEvent("click",1,1,window,0,0,0,0,0,0,0,0,0,0,null),!b.dispatchEvent(e))return}else if(b.fireEvent&&!b.fireEvent("onclick"))return;v.location=d}else if(self.frames[c])self.frames[c].document.location=d;else{try{if(top.frames[c])return void(top.frames[c].document.location=d)}catch(a){}window.open(d,c)}},q=Aa.prototype,q.SourceElements=function(){return v.querySelectorAll?v.querySelectorAll("#"+this.source):[v.getElementById(this.source)]},q.HideTags=function(){var b,a=this.SourceElements();for(b=0;b<a.length;++b)a[b].style.display="none"},q.GetTags=function(){var b,d,e,f,a=this.SourceElements(),c=[];for(f=0;f<=this.repeatTags;++f)for(d=0;d<a.length;++d)for(b=a[d].getElementsByTagName("a"),e=0;e<b.length;++e)c.push(b[e]);return c},q.Message=function(a){var c,d,h,i,j,k,b=[],g=a.split("");for(c=0;c<g.length;++c)" "!=g[c]&&(d=c-g.length/2,h=v.createElement("A"),h.href="#",h.innerText=g[c],j=100*e(d/9),k=-100*f(d/9),i=new za(this,g[c],h,[j,0,k],2,18,"#000","#fff",0,0,0,"monospace",2,g[c]),i.Init(),b.push(i));return b},q.CreateTag=function(a){var b,c,d,e,f,g,h,i,j=[0,0,0];return"text"!=this.imageMode&&(b=a.getElementsByTagName("img"),b.length&&(c=new Image,c.src=b[0].src,!this.imageMode))?(d=new za(this,"",a,j,0,0),d.SetImage(c),fa(c,b[0],d,this),d):("image"!=this.imageMode&&(f=new xa(a),e=f.Lines(),f.Empty()?f=null:(g=this.textFont||ca(ga(a,"font-family")),this.splitWidth&&(e=f.SplitWidth(this.splitWidth,this.ctxt,g,this.textHeight)),h="tag"==this.bgColour?ga(a,"background-color"):this.bgColour,i="tag"==this.bgOutline?ga(a,"color"):this.bgOutline)),f||c?(d=new za(this,e,a,j,2,this.textHeight+2,this.textColour||ga(a,"color"),h,this.bgRadius,i,this.bgOutlineThickness,g,this.padding,f&&f.original),c?(d.SetImage(c),fa(c,b[0],d,this)):d.Init(),d):void 0)},q.UpdateTag=function(a,b){var c=this.textColour||ga(b,"color"),d=this.textFont||ca(ga(b,"font-family")),e="tag"==this.bgColour?ga(b,"background-color"):this.bgColour,f="tag"==this.bgOutline?ga(b,"color"):this.bgOutline;a.a=b,a.title=b.title,a.colour==c&&a.textFont==d&&a.bgColour==e&&a.bgOutline==f||a.SetFont(d,c,e,f)},q.Weight=function(a){var c,d,e,g,b=a.length,f=[],h=this.weightFrom?this.weightFrom.split(/[, ]/):[null],i=h.length;for(d=0;d<b;++d)for(f[d]=[],e=0;e<i;++e)c=ha(a[d].a,h[e],this.textHeight),(!this.max_weight[e]||c>this.max_weight[e])&&(this.max_weight[e]=c),(!this.min_weight[e]||c<this.min_weight[e])&&(this.min_weight[e]=c),f[d][e]=c;for(e=0;e<i;++e)this.max_weight[e]>this.min_weight[e]&&(g=1);if(g)for(d=0;d<b;++d)a[d].SetWeight(f[d])},q.Load=function(){var c,d,e,f,h,i,j,k,a=this.GetTags(),b=[],l=[],m={sphere:I,vcylinder:L,hcylinder:M,vring:N,hring:O};if(a.length){for(l.length=a.length,k=0;k<a.length;++k)l[k]=k;for(this.shuffleTags&&E(l),f=100*this.radiusX,h=100*this.radiusY,i=100*this.radiusZ,this.max_radius=g(f,g(h,i)),k=0;k<a.length;++k)(d=this.CreateTag(a[l[k]]))&&b.push(d);for(this.weight&&this.Weight(b,!0),this.shapeArgs?this.shapeArgs[0]=b.length:(e=this.shape.toString().split(/[(),]/),c=e.shift(),"function"==typeof window[c]?this.shape=window[c]:this.shape=m[c]||m.sphere,this.shapeArgs=[b.length,f,h,i].concat(e)),j=this.shape.apply(this,this.shapeArgs),this.listLength=b.length,k=0;k<b.length;++k)b[k].position=new F(j[k][0],j[k][1],j[k][2])}this.noTagsMessage&&!b.length&&(k=this.imageMode&&"both"!=this.imageMode?this.imageMode+" ":"",b=this.Message("No "+k+"tags")),this.taglist=b},q.Update=function(){var d,g,h,j,k,l,a=this.GetTags(),b=[],c=this.taglist,e=[],f=[];if(!this.shapeArgs)return this.Load();if(a.length){for(j=this.listLength=a.length,h=c.length,k=0;k<h;++k)b.push(c[k]),f.push(k);for(k=0;k<j;++k){for(l=0,d=0;l<h;++l)c[l].EqualTo(a[k])&&(this.UpdateTag(b[l],a[k]),d=f[l]=-1);d||e.push(k)}for(k=0,l=0;k<h;++k)-1==f[l]?f.splice(l,1):++l;if(f.length){for(E(f);f.length&&e.length;)k=f.shift(),l=e.shift(),b[k]=this.CreateTag(a[l]);for(f.sort(function(a,b){return a-b});f.length;)b.splice(f.pop(),1)}for(l=b.length/(e.length+1),k=0;e.length;)b.splice(i(++k*l),0,this.CreateTag(a[e.shift()]));for(this.shapeArgs[0]=j=b.length,g=this.shape.apply(this,this.shapeArgs),k=0;k<j;++k)b[k].position=new F(g[k][0],g[k][1],g[k][2]);this.weight&&this.Weight(b)}this.taglist=b},q.SetShadow=function(a){a.shadowBlur=this.shadowBlur,a.shadowOffsetX=this.shadowOffset[0],a.shadowOffsetY=this.shadowOffset[1]},q.Draw=function(a){if(!this.paused){var j,k,l,r,b=this.canvas,c=b.width,d=b.height,e=0,f=(a-this.time)*Aa.interval/1e3,g=c/2+this.offsetX,h=d/2+this.offsetY,i=this.ctxt,m=-1,n=this.taglist,o=n.length,p=this.frontSelect,q=this.centreFunc==B;if(this.time=a,this.frozen&&this.drawn)return this.Animate(c,d,f);for(r=this.AnimateFixed(),i.setTransform(1,0,0,1,0,0),l=0;l<o;++l)n[l].Calc(this.transform,this.fixedAlpha);if(n=D(n,function(a,b){return b.z-a.z}),r&&this.fixedAnim.active)j=this.fixedAnim.tag.UpdateActive(i,g,h);else{for(this.active=null,l=0;l<o;++l)(k=this.mx>=0&&this.my>=0&&this.taglist[l].CheckActive(i,g,h))&&k.sc>e&&(!p||k.z<=0)&&(j=k,m=l,j.tag=this.taglist[l],e=k.sc);this.active=j}for(this.txtOpt||this.shadow&&this.SetShadow(i),i.clearRect(0,0,c,d),l=0;l<o;++l){if(!q&&n[l].z<=0){try{this.centreFunc(i,c,d,g,h)}catch(a){alert(a),this.centreFunc=B}q=!0}j&&j.tag==n[l]&&j.PreDraw(i,n[l],g,h)||n[l].Draw(i,g,h),j&&j.tag==n[l]&&j.PostDraw(i)}this.freezeActive&&j?this.Freeze():(this.UnFreeze(),this.drawn=o==this.listLength),this.fixedCallback&&(this.fixedCallback(this,this.fixedCallbackTag),this.fixedCallback=null),r||this.Animate(c,d,f),j&&j.LastDraw(i),b.style.cursor=j?this.activeCursor:"",this.Tooltip(j,this.taglist[m])}},q.TooltipNone=function(){},q.TooltipNative=function(a,b){this.canvas.title=a?b&&b.title?b.title:"":this.ctitle},q.SetTTDiv=function(a,b){var c=this,d=c.ttdiv.style;a!=c.ttdiv.innerHTML&&(d.display="none"),c.ttdiv.innerHTML=a,b&&(b.title=c.ttdiv.innerHTML),"none"!=d.display||c.tttimer||(c.tttimer=setTimeout(function(){var a=va(c.canvas.id);d.display="block",d.left=a.x+c.mx+"px",d.top=a.y+c.my+24+"px",c.tttimer=null},c.tooltipDelay))},q.TooltipDiv=function(a,b){a&&b&&b.title?this.SetTTDiv(b.title,b):!a&&-1!=this.mx&&-1!=this.my&&this.ctitle.length?this.SetTTDiv(this.ctitle):this.ttdiv.style.display="none"},q.Transform=function(a,b,c){if(b||c){var d=e(b),g=f(b),h=e(c),i=f(c),j=new H([i,0,h,0,1,0,-h,0,i]),k=new H([1,0,0,0,g,-d,0,d,g]);a.transform=a.transform.mul(j.mul(k))}},q.AnimateFixed=function(){var a,b,c,d,e;return this.fadeIn&&(b=C()-this.startTime,b>=this.fadeIn?(this.fadeIn=0,this.fixedAlpha=1):this.fixedAlpha=b/this.fadeIn),!!this.fixedAnim&&(this.fixedAnim.transform||(this.fixedAnim.transform=this.transform),a=this.fixedAnim,b=C()-a.t0,c=a.angle,e=this.animTiming(a.t,b),this.transform=a.transform,b>=a.t?(this.fixedCallbackTag=a.tag,this.fixedCallback=a.cb,this.fixedAnim=this.yaw=this.pitch=0):c*=e,d=H.Rotation(c,a.axis),this.transform=this.transform.mul(d),0!=this.fixedAnim)},q.AnimatePosition=function(a,b,c){var g,h,d=this,e=d.mx,f=d.my;!d.frozen&&e>=0&&f>=0&&e<a&&f<b?(g=d.maxSpeed,h=d.reverse?-1:1,d.lx||(d.yaw=(2*e*g/a-g)*h*c),d.ly||(d.pitch=(2*f*g/b-g)*-h*c),d.initial=null):d.initial||(d.frozen&&!d.freezeDecel?d.yaw=d.pitch=0:d.Decel(d)),this.Transform(d,d.pitch,d.yaw)},q.AnimateDrag=function(a,b,c){var d=this,e=100*c*d.maxSpeed/d.max_radius/d.zoom;d.dx||d.dy?(d.lx||(d.yaw=d.dx*e/d.stretchX),d.ly||(d.pitch=d.dy*-e/d.stretchY),d.dx=d.dy=0,d.initial=null):d.initial||d.Decel(d),this.Transform(d,d.pitch,d.yaw)},q.Freeze=function(){this.frozen||(this.preFreeze=[this.yaw,this.pitch],this.frozen=1,this.drawn=0)},q.UnFreeze=function(){this.frozen&&(this.yaw=this.preFreeze[0],this.pitch=this.preFreeze[1],this.frozen=0)},q.Decel=function(a){var b=a.minSpeed,c=d(a.yaw),e=d(a.pitch);!a.lx&&c>b&&(a.yaw=c>a.z0?a.yaw*a.decel:0),!a.ly&&e>b&&(a.pitch=e>a.z0?a.pitch*a.decel:0)},q.Zoom=function(a){this.z2=this.z1*(1/a),this.drawn=0},q.Clicked=function(a){var b=this.active;try{b&&b.tag&&(!1===this.clickToFront||null===this.clickToFront?b.tag.Clicked(a):this.TagToFront(b.tag,this.clickToFront,function(){b.tag.Clicked(a)},!0))}catch(a){}},q.Wheel=function(a){var b=this.zoom+this.zoomStep*(a?1:-1);this.zoom=h(this.zoomMax,g(this.zoomMin,b)),this.Zoom(this.zoom)},q.BeginDrag=function(a){this.down=ja(a,this.canvas),a.cancelBubble=!0,a.returnValue=!1,a.preventDefault&&a.preventDefault()},q.Drag=function(a,b){if(this.dragControl&&this.down){var c=this.dragThreshold*this.dragThreshold,d=b.x-this.down.x,e=b.y-this.down.y;(this.dragging||d*d+e*e>c)&&(this.dx=d,this.dy=e,this.dragging=1,this.down=b)}return this.dragging},q.EndDrag=function(){var a=this.dragging;return this.dragging=this.down=null,a},q.BeginPinch=function(a){this.pinched=[Ba(a),this.zoom],a.preventDefault&&a.preventDefault()},q.Pinch=function(a){var b,c,d=this.pinched;d&&(c=Ba(a),b=d[1]*c/d[0],this.zoom=h(this.zoomMax,g(this.zoomMin,b)),this.Zoom(this.zoom))},q.EndPinch=function(a){this.pinched=null},q.Pause=function(){this.paused=!0},q.Resume=function(){this.paused=!1},q.SetSpeed=function(a){this.initial=a,this.yaw=a[0]*this.maxSpeed,this.pitch=a[1]*this.maxSpeed},q.FindTag=function(a){if(!y(a))return null;if(y(a.index)&&(a=a.index),!z(a))return this.taglist[a];var b,c,d;for(y(a.id)?(b="id",c=a.id):y(a.text)&&(b="innerText",c=a.text),d=0;d<this.taglist.length;++d)if(this.taglist[d].a[b]==c)return this.taglist[d]},q.RotateTag=function(a,b,c,d,e,f){var g=a.Calc(this.transform,1),h=new F(g.x,g.y,g.z),i=G(c,b),j=h.angle(i),k=h.cross(i).unit();0==j?(this.fixedCallbackTag=a,this.fixedCallback=e):this.fixedAnim={angle:-j,axis:k,t:d,t0:C(),cb:e,tag:a,active:f}},q.TagToFront=function(a,b,c,d){this.RotateTag(a,0,0,b,c,d)},Aa.Start=function(a,b,c){Aa.Delete(a),Aa.tc[a]=new Aa(a,b,c)},Aa.Linear=function(a,b){return b/a},Aa.Smooth=function(a,b){return.5-f(b*Math.PI/a)/2},Aa.Pause=function(a){Ca("Pause",a)},Aa.Resume=function(a){Ca("Resume",a)},Aa.Reload=function(a){Ca("Load",a)},Aa.Update=function(a){Ca("Update",a)},Aa.SetSpeed=function(a,b){return!(!z(b)||!Aa.tc[a]||isNaN(b[0])||isNaN(b[1]))&&(Aa.tc[a].SetSpeed(b),!0)},Aa.TagToFront=function(a,b){return!!z(b)&&(b.lat=b.lng=0,Aa.RotateTag(a,b))},Aa.RotateTag=function(a,b){if(z(b)&&Aa.tc[a]){isNaN(b.time)&&(b.time=500);var c=Aa.tc[a].FindTag(b);if(c)return Aa.tc[a].RotateTag(c,b.lat,b.lng,b.time,b.callback,b.active),!0}return!1},Aa.Delete=function(a){var b,c;if(x[a]&&(c=v.getElementById(a)))for(b=0;b<x[a].length;++b)ea(x[a][b][0],x[a][b][1],c);delete x[a],delete Aa.tc[a]},Aa.NextFrameRAF=function(){requestAnimationFrame(ua)},Aa.NextFrameTimeout=function(a){setTimeout(ta,a)},Aa.tc={},Aa.options={z1:2e4,z2:2e4,z0:2e-4,freezeActive:!1,freezeDecel:!1,activeCursor:"pointer",pulsateTo:1,pulsateTime:3,reverse:!1,depth:.5,maxSpeed:.05,minSpeed:0,decel:.95,interval:20,minBrightness:.1,maxBrightness:1,outlineColour:"#ffff99",outlineThickness:2,outlineOffset:5,outlineMethod:"outline",outlineRadius:0,textColour:"#ff99ff",textHeight:15,textFont:"Helvetica, Arial, sans-serif",shadow:"#000",shadowBlur:0,shadowOffset:[0,0],initial:null,hideTags:!0,zoom:1,weight:!1,weightMode:"size",weightFrom:null,weightSize:1,weightSizeMin:null,weightSizeMax:null,weightGradient:{0:"#f00",.33:"#ff0",.66:"#0f0",1:"#00f"},txtOpt:!0,txtScale:2,frontSelect:!1,wheelZoom:!0,zoomMin:.3,zoomMax:3,zoomStep:.05,shape:"sphere",lock:null,tooltip:null,tooltipDelay:300,tooltipClass:"tctooltip",radiusX:1,radiusY:1,radiusZ:1,stretchX:1,stretchY:1,offsetX:0,offsetY:0,shuffleTags:!1,noSelect:!1,noMouse:!1,imageScale:1,paused:!1,dragControl:!1,dragThreshold:4,centreFunc:B,splitWidth:0,animTiming:"Smooth",clickToFront:!1,fadeIn:0,padding:0,bgColour:null,bgRadius:0,bgOutline:null,bgOutlineThickness:0,outlineIncrease:4,textAlign:"centre",textVAlign:"middle",imageMode:null,imagePosition:null,imagePadding:2,imageAlign:"centre",imageVAlign:"middle",noTagsMessage:!0,centreImage:null,pinchZoom:!1,repeatTags:0,minTags:0,imageRadius:0,scrollPause:!1,outlineDash:0,outlineDashSpace:0,outlineDashSpeed:1};for(b in Aa.options)Aa[b]=Aa.options[b];window.TagCanvas=Aa,jQuery.fn.tagcanvas=function(b,c){var d={pause:function(){a(this).each(function(){Ca("Pause",a(this)[0].id)})},resume:function(){a(this).each(function(){Ca("Resume",a(this)[0].id)})},reload:function(){a(this).each(function(){Ca("Load",a(this)[0].id)})},update:function(){a(this).each(function(){Ca("Update",a(this)[0].id)})},tagtofront:function(){a(this).each(function(){Aa.TagToFront(a(this)[0].id,c)})},rotatetag:function(){a(this).each(function(){Aa.RotateTag(a(this)[0].id,c)})},delete:function(){a(this).each(function(){Aa.Delete(a(this)[0].id)})},setspeed:function(){a(this).each(function(){Aa.SetSpeed(a(this)[0].id,c)})}};return"string"==typeof b&&d[b]?(d[b].apply(this),this):(Aa.jquery=1,a(this).each(function(){Aa.Start(a(this)[0].id,c,b)}),Aa.started)},da("load",function(){Aa.loaded=1},window)}(jQuery);
